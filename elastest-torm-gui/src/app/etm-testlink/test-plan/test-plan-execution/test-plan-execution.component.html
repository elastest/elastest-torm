<div layout="row" layout-gt-xl="row" tdMediaToggle="gt-xs" layout-fill>
  <div flex-gt-sm="40" layout-gt-sm="column" layout-fill>
    <mat-card tdMediaToggle="gt-xs" flex style="overflow: auto;">
      <div layout="column" layout-fill>
        <mat-card-title>
          <div layout="column" layout-align="none" *ngIf="exTJobExec">
            <div layout="row">
              <span>
                <button mat-button *ngIf="exTJobExec.finished()" (click)="viewEndedTJobExec()" class="onlyIconBtn" title="Navigate to result page">
                  <mat-icon style="vertical-align: middle;" [style.color]="this.exTJobExec.getResultIcon().color">{{this.exTJobExec.getResultIcon().name}}</mat-icon>
                </button>
              </span>
              <span id="executingTitle">Executing Test Plan "{{testPlan.name}}" - Build "{{selectedBuild.name}}"- Exec {{exTJobExec.id}}
              </span>
              <span flex></span>
              <span>
                <button *ngIf="showStopBtn" mat-button (click)="forceEnd()" [style.color]="'#c82a0e'" title="Force End" class="iconBtn">
                  <mat-icon>stop</mat-icon>
                </button>
              </span>
              <span>
                <button mat-button (click)="logsAndMetrics.openMonitoringConfig()" title="Open Monitoring Config" class="iconBtn">
                  <mat-icon>settings</mat-icon>
                </button>
              </span>
            </div>
            <div layout="row" class="push-top-sm">
              <span id="resultMsgText" class="mat-subhead" style="vertical-align: middle;">{{exTJobExec.resultMsg}}</span>
            </div>
          </div>
        </mat-card-title>
        <mat-divider></mat-divider>
        <mat-card-content flex class="push-bottom-none">
          <div *ngIf="!browserAndEusLoading && exTJob && exTJobExec && !exTJobExec.finished() && exTJobExec.executing(); else showMessage"
            layout="column" layout-fill>
            <div id="testLinkExec" flex>
              <testlink-execution-form #tlExecutionForm *ngIf="data && data.testCase" [data]="data"></testlink-execution-form>
            </div>
            <div layout="row">
              <button mat-raised-button color="accent" id="saveAndNext" *ngIf="tlExecutionForm" [disabled]="disableTLNextBtn || !tlExecutionForm.isValidForm()"
                (click)="saveTLCaseExecution()">Save & Next</button>
            </div>
          </div>
          <ng-template #showMessage>
            <div layout-align="center center" layout="column" layout-fill>
              <div class="mat-headline text-center">{{executionCardMsg}}</div>
              <div class="mat-subhead text-center" *ngIf="execFinished">{{executionCardSubMsg}}</div>
            </div>
          </ng-template>
        </mat-card-content>
      </div>
    </mat-card>
  </div>
  <div flex-gt-sm="60" layout-gt-sm="column" layout-fill>
    <mat-card tdMediaToggle="gt-xs" flex>
      <div layout="column" layout-fill>
        <mat-card-title>
          <div layout="column" layout-align="none">
            <div layout="row">
              <span>Browser</span>
              <span flex></span>
              <a *ngIf="!browserAndEusLoading && vncBrowserUrl !== undefined" mat-button [attr.href]="vncBrowserUrl" class="iconBtn" target="_blank"
                matTooltip="Open in new tab">
                <mat-icon>open_in_new</mat-icon>
              </a>
            </div>

            <div *ngIf="browserAndEusLoading && eusTestModel !== undefined && eusTestModel.statusMsg !== undefined && eusTestModel.statusMsg !== ''"
              layout="row" class="push-top-sm">
              <span id="resultMsgText" class="mat-subhead" style="vertical-align: middle;">{{eusTestModel.statusMsg}}</span>
            </div>
          </div>
        </mat-card-title>
        <mat-divider></mat-divider>
        <mat-card-content *ngIf="exTJobExec" flex style="overflow: auto;" class="push-bottom-none">
          <div layout-align="center center" layout="column" layout-fill>
            <ng-container *ngIf="!browserAndEusLoading && vncBrowserUrl !== undefined; else loadingBrowser">
              <vnc-client [vncUrl]="vncBrowserUrl" [autoconnect]="autoconnect" [viewOnly]="viewOnly" [showStatus]="false" [showConnectionBtns]="false"
                [bgColor]="'#ffffff'" layout-fill></vnc-client>
            </ng-container>
            <ng-template #loadingBrowser>
              <div class="mat-headline text-center">{{browserCardMsg}}</div>
              <mat-spinner *ngIf="exTJobExec && (!exTJobExec.finished() || (exTJobExec.finished() && !browserAndEusDeprovided))" strokeWidth="6"
                color="accent" class="push-top-sm"></mat-spinner>
            </ng-template>
          </div>
        </mat-card-content>
      </div>
    </mat-card>
  </div>
</div>

<!-- logs & Metrics -->
<etm-monitoring-view *ngIf="exTJobExec !== undefined" #logsAndMetrics [live]="true" [showConfigBtn]="false"></etm-monitoring-view>

<!-- Files -->
<etm-files-manager *ngIf="exTJob && exTJobExec && showFiles" [tJobId]="exTJob.id" [tJobExecId]="exTJobExec.id" [external]="true"></etm-files-manager>